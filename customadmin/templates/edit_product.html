{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Product - TV Shop Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", sans-serif;
      }
      .main-content {
        margin-left: 250px;
        padding: 30px;
        padding-bottom: 100px;
      }
      .admin-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 25px;
        border: 1px solid #dee2e6;
      }
      .card-header-custom {
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
        padding-bottom: 10px;
        font-weight: bold;
        color: #2c3e50;
        font-size: 1.1rem;
      }
      .img-slot {
        border: 2px dashed #ccc;
        border-radius: 8px;
        padding: 10px;
        text-align: center;
        background: #f9f9f9;
      }
      .main-slot {
        border-color: #3498db;
        background: #e3f2fd;
      }
      @media (max-width: 768px) {
        .sidebar {
          width: 0;
        }
        .main-content {
          margin-left: 0;
        }
      }
    </style>
    <link rel="stylesheet" href="{% static 'Admin/css/admin_style.css' %}" />
  </head>
  <body>
    {% include "admin_sidebar.html" %} {% include "admin_header.html" %}

    <div class="main-content">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      <form
        action="{% url 'edit_product' product.id %}"
        method="POST"
        enctype="multipart/form-data"
      >
        {% csrf_token %}

        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="fw-bold">Edit Product</h2>
          <div>
            <button type="submit" class="btn btn-success">
              <i class="fas fa-save me-2"></i> Update Product
            </button>
            <a href="{% url 'product' %}" class="btn btn-secondary">
              <i class="fas fa-arrow-left me-2"></i> Back to Products
            </a>
          </div>
        </div>

        <div class="admin-card">
          <div class="card-header-custom">
            <i class="fas fa-info-circle me-2"></i>Basic Details
          </div>
          <div class="row">
            <div class="col-md-12 mb-3">
              <label class="form-label">Product Title</label>
              <input
                type="text"
                class="form-control"
                name="title"
                required
                value="{{ product.title }}"
                placeholder="e.g. Samsung 65 Inch TV"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Original Price ($)</label>
              <input
                type="number"
                step="0.01"
                class="form-control"
                name="price"
                required
                value="{{ product.original_price }}"
                placeholder="2500.00"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Discount Percentage (%)</label>
              <input
                type="number"
                class="form-control"
                name="discount"
                value="{{ product.discount_percentage }}"
                placeholder="10"
              />
              <small class="text-muted"
                >Final price will be calculated automatically upon
                saving.</small
              >
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Stock Quantity</label>
              <input
                type="number"
                class="form-control"
                name="stock"
                min="0"
                value="{{ product.stock }}"
                placeholder="0"
              />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Brand</label>
              <select class="form-control" name="brand" required>
                <option value="">Select Brand</option>
                {% for brand in brands %}
                <option value="{{ brand.id }}" {% if brand.id == product.brand.id %}selected{% endif %}>{{ brand.bname }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>

        <div class="admin-card">
          <div class="card-header-custom">
            <i class="fas fa-images me-2"></i>Media Gallery
          </div>
          <div class="row g-3">
            <div class="col-md-4">
              <div class="img-slot main-slot">
                <span class="badge bg-primary mb-2">Main Image</span>
                <img src="{{ product.main_image.url }}" class="img-fluid mb-2" style="max-height: 100px;" />
                <input
                  type="file"
                  name="main_image"
                  class="form-control mt-2"
                />
                <small class="text-muted">Leave empty to keep current image</small>
              </div>
            </div>
            <div class="col-md-8">
              <div class="row g-2">
                <div class="col-6">
                  <div class="img-slot">
                    <small class="text-muted">Thumbnail 1</small>
                    {% if product.thumb_1 %}
                    <img src="{{ product.thumb_1.url }}" class="img-fluid mb-2" style="max-height: 80px;" />
                    {% endif %}
                    <input
                      type="file"
                      name="thumb_1"
                      class="form-control form-control-sm mt-2"
                    />
                  </div>
                </div>
                <div class="col-6">
                  <div class="img-slot">
                    <small class="text-muted">Thumbnail 2</small>
                    {% if product.thumb_2 %}
                    <img src="{{ product.thumb_2.url }}" class="img-fluid mb-2" style="max-height: 80px;" />
                    {% endif %}
                    <input
                      type="file"
                      name="thumb_2"
                      class="form-control form-control-sm mt-2"
                    />
                  </div>
                </div>
                <div class="col-6">
                  <div class="img-slot">
                    <small class="text-muted">Thumbnail 3</small>
                    {% if product.thumb_3 %}
                    <img src="{{ product.thumb_3.url }}" class="img-fluid mb-2" style="max-height: 80px;" />
                    {% endif %}
                    <input
                      type="file"
                      name="thumb_3"
                      class="form-control form-control-sm mt-2"
                    />
                  </div>
                </div>
                <div class="col-6">
                  <div class="img-slot">
                    <small class="text-muted">Thumbnail 4</small>
                    {% if product.thumb_4 %}
                    <img src="{{ product.thumb_4.url }}" class="img-fluid mb-2" style="max-height: 80px;" />
                    {% endif %}
                    <input
                      type="file"
                      name="thumb_4"
                      class="form-control form-control-sm mt-2"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="admin-card">
          <div class="card-header-custom">
            <i class="fas fa-list-ul me-2"></i>Key Features
          </div>
          <div class="alert alert-info py-2 small">
            <i class="fas fa-info-circle"></i> Enter each feature on a
            <strong>new line</strong>.
          </div>
          <textarea
            class="form-control"
            name="features"
            rows="6"
            placeholder="4K Resolution&#10;120Hz Refresh Rate&#10;Smart AI Processor"
          >{% for feature in product.features.all %}{{ feature.feature_text }}
{% endfor %}</textarea>
        </div>

        <div class="admin-card">
          <div class="card-header-custom">
            <i class="fas fa-align-left me-2"></i>Product Description
          </div>
          <textarea
            class="form-control"
            name="description"
            rows="6"
            placeholder="Enter detailed product description here..."
          >{{ product.description_html }}</textarea>
        </div>
      </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
