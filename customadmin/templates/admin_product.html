{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products - TV Shop Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'Admin/css/product.css' %}" />
    <link rel="stylesheet" href="{% static 'Admin/css/admin_style.css' %}" />
</head>
<body>

    {% include "admin_sidebar.html"%}
{% include "admin_header.html"%}
    <div class="main-content">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold">Product Management</h2>
                <p class="text-muted">Manage your TV inventory, update prices, and track stock.</p>
            </div>
            <button class="btn btn-primary" onclick="openAddModal()">
                <i class="fas fa-plus-circle me-2"></i> Add New Product
            </button>
        </div>

        <div class="table-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex gap-2">
                    <select class="form-select" style="width: 150px;" onchange="filterCategory(this.value)">
                        <option value="All">All Brands</option>
                        <option value="Samsung">Samsung</option>
                        <option value="Sony">Sony</option>
                        <option value="LG">LG</option>
                    </select>
                    <select class="form-select" style="width: 150px;">
                        <option>Stock Status</option>
                        <option>In Stock</option>
                        <option>Low Stock</option>
                    </select>
                </div>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search products..." onkeyup="searchTable()">
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col"><input type="checkbox" class="form-check-input"></th>
                            <th scope="col">Image</th>
                            <th scope="col">Product Name</th>
                            <th scope="col">SKU</th>
                            <th scope="col">Price</th>
                            <th scope="col">Stock</th>
                            <th scope="col">Status</th>
                            <th scope="col" class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        </tbody>
                </table>
            </div>

            <nav class="mt-3">
                <ul class="pagination justify-content-end">
                    <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="editId"> <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Product Name</label>
                                    <input type="text" class="form-control" id="pName" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Brand</label>
                                        <select class="form-select" id="pBrand">
                                            <option value="Samsung">Samsung</option>
                                            <option value="LG">LG</option>
                                            <option value="Sony">Sony</option>
                                            <option value="TCL">TCL</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">SKU Code</label>
                                        <input type="text" class="form-control" id="pSku" placeholder="TV-SAM-55">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Price ($)</label>
                                        <input type="number" class="form-control" id="pPrice" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Stock Qty</label>
                                        <input type="number" class="form-control" id="pStock" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Product Image</label>
                                    <div class="card bg-light d-flex justify-content-center align-items-center" style="height: 150px; border: 2px dashed #ccc;">
                                        <div class="text-center text-muted">
                                            <i class="fas fa-cloud-upload-alt fs-3"></i>
                                            <p class="small mb-0">Drop image here</p>
                                        </div>
                                    </div>
                                    <input type="file" class="form-control mt-2" accept="image/*">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" rows="3"></textarea>
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="saveBtn">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 1. Mock Data Source
        let products = [
            { id: 1, name: "Samsung Crystal 4K UHD", brand: "Samsung", sku: "SAM-4K-55", price: 549, stock: 45, status: "Active", img: "https://via.placeholder.com/50" },
            { id: 2, name: "LG OLED C1 Series", brand: "LG", sku: "LG-OLED-65", price: 1299, stock: 12, status: "Active", img: "https://via.placeholder.com/50" },
            { id: 3, name: "Sony Bravia XR", brand: "Sony", sku: "SNY-XR-50", price: 899, stock: 0, status: "Inactive", img: "https://via.placeholder.com/50" },
            { id: 4, name: "TCL Roku Smart TV", brand: "TCL", sku: "TCL-RK-32", price: 199, stock: 120, status: "Active", img: "https://via.placeholder.com/50" },
            { id: 5, name: "Samsung Neo QLED 8K", brand: "Samsung", sku: "SAM-8K-75", price: 3499, stock: 5, status: "Active", img: "https://via.placeholder.com/50" },
        ];

        // 2. Render Table Function
        const tableBody = document.getElementById('productTableBody');

        function renderProducts(data) {
            tableBody.innerHTML = "";
            
            if(data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="8" class="text-center py-4">No products found</td></tr>`;
                return;
            }

            data.forEach(p => {
                // Status Badge Logic
                let badgeClass = p.status === "Active" ? "bg-success" : "bg-secondary";
                
                // Stock Warning Logic
                let stockColor = p.stock < 10 ? "text-danger fw-bold" : "text-dark";

                let row = `
                    <tr>
                        <td><input type="checkbox" class="form-check-input"></td>
                        <td><img src="${p.img}" class="product-img" alt="tv"></td>
                        <td>
                            <div class="fw-bold">${p.name}</div>
                            <small class="text-muted">${p.brand}</small>
                        </td>
                        <td><code>${p.sku}</code></td>
                        <td>$${p.price}</td>
                        <td class="${stockColor}">${p.stock}</td>
                        <td>
                            <span class="badge ${badgeClass} status-badge" onclick="toggleStatus(${p.id})">${p.status}</span>
                        </td>
                        <td class="text-end">
                            <button class="btn btn-sm btn-light action-btn" onclick="editProduct(${p.id})"><i class="fas fa-pen text-primary"></i></button>
                            <button class="btn btn-sm btn-light action-btn" onclick="deleteProduct(${p.id})"><i class="fas fa-trash text-danger"></i></button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // 3. Initial Load
        renderProducts(products);

        // 4. Search Functionality
        function searchTable() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(val) || 
                p.brand.toLowerCase().includes(val) ||
                p.sku.toLowerCase().includes(val)
            );
            renderProducts(filtered);
        }

        // 5. Filter by Brand
        function filterCategory(brand) {
            if (brand === "All") {
                renderProducts(products);
            } else {
                const filtered = products.filter(p => p.brand === brand);
                renderProducts(filtered);
            }
        }

        // 6. Delete Action
        function deleteProduct(id) {
            if(confirm("Are you sure you want to permanently delete this product?")) {
                products = products.filter(p => p.id !== id);
                renderProducts(products); // Refresh table
            }
        }

        // 7. Toggle Status (Active/Inactive)
        function toggleStatus(id) {
            const product = products.find(p => p.id === id);
            product.status = product.status === "Active" ? "Inactive" : "Active";
            renderProducts(products);
        }

        // 8. Add/Edit Modal Logic
        const modalEl = document.getElementById('productModal');
        const modal = new bootstrap.Modal(modalEl);
        
        function openAddModal() {
            document.getElementById('productForm').reset();
            document.getElementById('modalTitle').innerText = "Add New Product";
            document.getElementById('editId').value = ""; // Clear ID
            modal.show();
        }

        function editProduct(id) {
            const p = products.find(prod => prod.id === id);
            
            // Populate Form
            document.getElementById('editId').value = p.id;
            document.getElementById('pName').value = p.name;
            document.getElementById('pBrand').value = p.brand;
            document.getElementById('pSku').value = p.sku;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pStock').value = p.stock;
            
            document.getElementById('modalTitle').innerText = "Edit Product";
            modal.show();
        }

        // 9. Form Submit (Handle Add AND Edit)
        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const idStr = document.getElementById('editId').value;
            const name = document.getElementById('pName').value;
            const brand = document.getElementById('pBrand').value;
            const sku = document.getElementById('pSku').value;
            const price = document.getElementById('pPrice').value;
            const stock = document.getElementById('pStock').value;

            if(idStr) {
                // EDIT MODE: Update existing
                const index = products.findIndex(p => p.id == idStr);
                products[index].name = name;
                products[index].brand = brand;
                products[index].sku = sku;
                products[index].price = price;
                products[index].stock = stock;
            } else {
                // ADD MODE: Create new
                const newId = products.length ? products[products.length - 1].id + 1 : 1;
                products.push({
                    id: newId,
                    name: name,
                    brand: brand,
                    sku: sku,
                    price: price,
                    stock: stock,
                    status: "Active",
                    img: "https://via.placeholder.com/50"
                });
            }

            modal.hide();
            renderProducts(products);
        });

    </script>
</body>
</html>