{%load static%}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TeleVision - Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
  </head>
  <body>
    {% include "dash.html"%}

    <div class="main-content">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Dashboard Overview</h2>
        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#addProductModal"
        >
          <i class="fas fa-plus"></i> Add New TV
        </button>
      </div>

      <div class="row mb-5">
        <div class="col-md-3">
          <div class="card stat-card bg-primary text-white">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <h6 class="card-title">Total Products</h6>
                <h3 id="totalProducts">0</h3>
              </div>
              <div class="icon-box"><i class="fas fa-box-open"></i></div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-success text-white">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <h6 class="card-title">Inventory Value</h6>
                <h3 id="totalValue">$0</h3>
              </div>
              <div class="icon-box"><i class="fas fa-dollar-sign"></i></div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-warning text-dark">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <h6 class="card-title">Pending Orders</h6>
                <h3>12</h3>
              </div>
              <div class="icon-box"><i class="fas fa-clock"></i></div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-info text-white">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <h6 class="card-title">Total Customers</h6>
                <h3>1,204</h3>
              </div>
              <div class="icon-box"><i class="fas fa-users"></i></div>
            </div>
          </div>
        </div>
      </div>

      <div class="table-container">
        <h4 class="mb-4">TV Inventory Management</h4>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Product Name</th>
                <th>Brand</th>
                <th>Screen Size</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="productTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="modal fade" id="addProductModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New TV Product</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addProductForm">
              <div class="mb-3">
                <label class="form-label">TV Model Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="tvName"
                  required
                  placeholder="e.g. Neo QLED 4K"
                />
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Brand</label>
                  <select class="form-select" id="tvBrand">
                    <option value="Samsung">Samsung</option>
                    <option value="LG">LG</option>
                    <option value="Sony">Sony</option>
                    <option value="TCL">TCL</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Size (Inches)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="tvSize"
                    required
                    placeholder="55"
                  />
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Price ($)</label>
                  <input
                    type="number"
                    class="form-control"
                    id="tvPrice"
                    required
                    placeholder="999"
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Stock Quantity</label>
                  <input
                    type="number"
                    class="form-control"
                    id="tvStock"
                    required
                    placeholder="10"
                  />
                </div>
              </div>
              <button type="submit" class="btn btn-primary w-100">
                Add Product
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // 1. Initial Dummy Data (Simulating a Database)
      let products = [
        {
          id: 101,
          name: "Samsung Crystal UHD",
          brand: "Samsung",
          size: 55,
          price: 600,
          stock: 15,
        },
        {
          id: 102,
          name: "LG OLED C3 Series",
          brand: "LG",
          size: 65,
          price: 1600,
          stock: 5,
        },
        {
          id: 103,
          name: "Sony Bravia XR",
          brand: "Sony",
          size: 50,
          price: 900,
          stock: 8,
        },
        {
          id: 104,
          name: "TCL Roku Smart TV",
          brand: "TCL",
          size: 43,
          price: 300,
          stock: 0,
        },
      ];

      // 2. Function to Render Table
      function renderTable() {
        const tableBody = document.getElementById("productTableBody");
        tableBody.innerHTML = ""; // Clear existing data

        let totalVal = 0;

        products.forEach((product, index) => {
          // Calculate logic for badges
          let stockStatus =
            product.stock > 0
              ? '<span class="badge bg-success">In Stock</span>'
              : '<span class="badge bg-danger">Out of Stock</span>';

          // Calculate inventory value
          totalVal += product.price * product.stock;

          const row = `
                    <tr>
                        <td>#${product.id}</td>
                        <td><strong>${product.name}</strong></td>
                        <td><span class="badge bg-secondary badge-brand">${
                          product.brand
                        }</span></td>
                        <td>${product.size}"</td>
                        <td>$${product.price.toLocaleString()}</td>
                        <td>${product.stock}</td>
                        <td>${stockStatus}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${
                              product.id
                            })"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
          tableBody.innerHTML += row;
        });

        // Update Dashboard Stats
        document.getElementById("totalProducts").innerText = products.length;
        document.getElementById("totalValue").innerText =
          "$" + totalVal.toLocaleString();
      }

      // 3. Function to Add Product
      document
        .getElementById("addProductForm")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // Stop page reload

          // Get values from form
          const name = document.getElementById("tvName").value;
          const brand = document.getElementById("tvBrand").value;
          const size = document.getElementById("tvSize").value;
          const price = parseFloat(document.getElementById("tvPrice").value);
          const stock = parseInt(document.getElementById("tvStock").value);

          // Create new object
          const newProduct = {
            id: Math.floor(Math.random() * 1000) + 100, // Random ID
            name: name,
            brand: brand,
            size: size,
            price: price,
            stock: stock,
          };

          // Add to array
          products.push(newProduct);

          // Refresh UI
          renderTable();

          // Close Modal & Reset Form
          document.getElementById("addProductForm").reset();
          const modalEl = document.getElementById("addProductModal");
          const modal = bootstrap.Modal.getInstance(modalEl);
          modal.hide();

          alert("Product Added Successfully!");
        });

      // 4. Function to Delete Product
      function deleteProduct(id) {
        if (confirm("Are you sure you want to delete this product?")) {
          products = products.filter((product) => product.id !== id);
          renderTable();
        }
      }

      // Initial Load
      renderTable();
    </script>
  </body>
</html>
